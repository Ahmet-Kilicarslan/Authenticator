<div class="otp-container">
  <div class="otp-card">

    <!-- Header -->
    <div class="otp-header">
      <div class="logo">
        <img src="/lubiv-dithered.png" alt="logo" class="logo-img">
      </div>
      <h2>Verify Your Email</h2>
      <p class="email-display">Code sent to <strong>{{ request.email }}</strong></p>
    </div>

    <!-- Timer Display -->
    @if (!verificationSuccess && timeRemaining > 0) {
      <div class="timer-container">
        <div class="timer-icon">⏱</div>
        <div class="timer-text">
          <span class="timer-label">Code expires in</span>
          <span class="timer-value" [class.timer-warning]="timeRemaining <= 60">
            {{ formattedTime }}
          </span>
        </div>
      </div>
    }

    <!-- Expired Message -->
    @if (timeRemaining <= 0 && !verificationSuccess) {
      <div class="expired-message">
        <div class="expired-icon">⚠</div>
        <p>Your verification code has expired</p>
      </div>
    }

    <!-- Success Message -->
    @if (verificationSuccess) {
      <div class="success-message" [class.show]="verificationSuccess">
        <div class="success-icon">✓</div>
        <h3>Email Verified!</h3>
        <p>Redirecting to login...</p>
      </div>
    }

    <!-- OTP Form (only show if not successful) -->
    @if (!verificationSuccess) {
      <form class="otp-form"
            (ngSubmit)="handleVerifyOTP()"
            novalidate>

        <!-- OTP Input -->
        <div class="form-group">
          <label for="otp" class="form-label">Enter 6-Digit Code</label>
          <div class="input-wrapper">
            <input type="text"
                   id="otp"
                   name="otp"
                   [(ngModel)]="request.otp"
                   maxlength="6"
                   pattern="[0-9]*"
                   inputmode="numeric"
                   placeholder="000000"
                   [disabled]="timeRemaining <= 0"
                   autocomplete="one-time-code"
                   required>
          </div>
          <span class="error-message" [class.show]="otpError">{{ otpError }}</span>
        </div>

        <!-- Button Group -->
        <div class="button-group">
          <!-- Verify Button -->
          <button type="submit"
                  class="btn-primary"
                  [class.loading]="isVerifying"
                  [disabled]="isVerifying || timeRemaining <= 0">
            <span class="btn-text">VERIFY</span>
            <div class="btn-loader">
              <div class="loader-bar"></div>
              <div class="loader-bar"></div>
              <div class="loader-bar"></div>
            </div>
          </button>

          <!-- Resend Button -->
          <button type="button"
                  class="btn-secondary"
                  [class.loading]="isResending"
                  [disabled]="!canResend || isResending"
                  (click)="handleResendOTP()">
            @if (canResend && !isResending) {
              <span class="btn-text">RESEND CODE</span>
            }
            @if (!canResend && !isResending) {
              <span class="btn-text">RESEND IN {{ resendCooldown }}s</span>
            }
            @if (isResending) {
              <div class="btn-loader">
                <div class="loader-bar"></div>
                <div class="loader-bar"></div>
                <div class="loader-bar"></div>
              </div>
            }
          </button>
        </div>

        <!-- Help Text -->
        <div class="help-text">
          <p>Didn't receive the code? Check your spam folder or try resending.</p>
        </div>

        <!-- Back Link -->
        <div class="back-link">
          <a (click)="goBack()" class="link">← Back to Registration</a>
        </div>
      </form>
    }

  </div>
</div>
